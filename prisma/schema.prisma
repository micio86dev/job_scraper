datasource db {
  provider = "mongodb"
  url      = env("MONGO_URI")
}

generator client {
  provider             = "prisma-client-py"
  recursive_type_depth = 5
}

model User {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  email      String   @unique
  password   String
  first_name String
  last_name  String
  role       String   @default("user")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  comments       Comment[]
  likes          Like[]
  profile        UserProfile?
  refresh_tokens RefreshToken[]

  @@map("users")
}

model Company {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  website     String?
  industry    String?
  size        String?
  location    String?
  logo_url    String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  // Extra fields for scraper
  normalized  String?  @unique
  raw         Json?

  // Relations
  jobs Job[]

  @@map("companies")
}

model Job {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  company_id       String    @db.ObjectId
  title            String
  description      String
  requirements     String[]
  benefits         String[]
  salary_min       Int?
  salary_max       Int?
  location         String?
  remote           Boolean   @default(false)
  employment_type  String?
  experience_level String?
  skills           String[]
  status           String    @default("active")
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  expires_at       DateTime?

  // Extra fields for scraper
  link        String?   @unique
  published   DateTime?
  language    String?
  email       String?
  raw         Json?
  inserted_at DateTime? @default(now())

  // Relations
  company  Company   @relation(fields: [company_id], references: [id])
  comments Comment[]
  likes    Like[]

  @@map("jobs")
}

model Comment {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  job_id     String   @db.ObjectId
  user_id    String   @db.ObjectId
  content    String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Relations
  job  Job  @relation(fields: [job_id], references: [id])
  user User @relation(fields: [user_id], references: [id])

  @@map("comments")
}

model Like {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id    String   @db.ObjectId
  job_id     String   @db.ObjectId
  created_at DateTime @default(now())

  // Relations
  user User @relation(fields: [user_id], references: [id])
  job  Job  @relation(fields: [job_id], references: [id])

  @@unique([user_id, job_id])
  @@map("likes")
}

model UserProfile {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  user_id      String   @unique @db.ObjectId
  languages    String[]
  skills       String[]
  seniority    String?
  availability String?
  cv_url       String?
  bio          String?
  github       String?
  linkedin     String?
  website      String?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  // Relations
  user User @relation(fields: [user_id], references: [id])

  @@map("user_profiles")
}

model RefreshToken {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  refresh_token String   @unique
  user_id       String   @db.ObjectId
  expires_at    DateTime
  created_at    DateTime @default(now())

  // Relations
  user User @relation(fields: [user_id], references: [id])

  @@map("refresh_tokens")
}
